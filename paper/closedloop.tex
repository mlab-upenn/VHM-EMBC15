\section{Closed-loop Testing of Pacemaker}
\label{closedloop}

= SS: Closed-loop.
Table comparing closed-loop with open-loop.
Robustness-guided testing.
%\input{openloop}

\begin{figure}[!t]
	\centering
	\includegraphics[scale=0.2]{placeHolder.pdf}
	\caption{\small Requirement-guided closed-loop testing methodology}
	\label{fig:reqGuidedTesting}
\end{figure} 

\textbf{Controlled inputs}.
In our setup, the testing algorithm will generate PVC waveforms to mimic the abnormal depolarizations of the ventricles that occur in a heart with arrythmia. 
These are used by the tester to try and cause the closed loop to manifest unsafe or undesirable heart conditions behavior. 
The constraint on the waveforms generated by the tester is that there should be at least 400ms between consecutive PVC impulses.

\textbf{Closed-loop setup}.
The closed-loop setup is the same as the setup for live operation shown in Fig.~\ref{fig:liveSetup}, with the addition of the tester at the PVC inputs to the heart.
That is, the pacemaker is connected to the heart, and the tester controls the external PVC disturbances.
The inputs to the pacemaker are provided by the heart model, and don't need to be pre-programmed by the validator.
This is shown in Fig.~\ref{fig:reqGuidedTesting}.

\textbf{Advantages over open-loop testing}.
The advantages of closed-loop testing over open-loop testing are summarized in Table \ref{table:CLoverOL}
How does closed-loop testing compare to the ideal state of affairs depicted in Section~\ref{testingObjectives}?
\begin{itemize}
	\item Choice of inputs: because a VHM provides the inputs to the pacemaker, we know that $A_{CL} \subset A_\Hc$, where $A_{CL}$ is the set of strings $\yb$ fed to the pacemaker in a closed-loop setup. 
	Thus, there is no risk of testing irrelevant scenarios\footnote{Of course, this ultimatley depends on the quality of the VHM.}
	This leaves open, of course, the question of how the tester chooses the disturbance inputs $\wb$. The answer is provided in Section \ref{testingMethodology}, but briefly, the $\wb$ choice is automatic and guided by the specification that we are testing, and is asymptotically complete (i.e. in the limit, $A_{CL} = A_\Hc$).
	\item Criterion of correctness: because we have a VHM, we can express correctness \emph{as a property of the heart's behavior}, and not of the pacemaker alone. 
	Thus we can evaluate what truly matters: is the heart (as modeled by the VHM) displaying unsafe or undesirable behavior?
\end{itemize}

It must be stressed that the interpretation of closed-loop testing results (bug or feature of the pacemaker?) depends on the specific violating behaviors that are found.
Some will be determined to be bugs. 
Others will be determined to be undesirable but necessary behaviors.
This is because specifying `safe' behavior is difficult for something as complex as the heart.

\textbf{The specification-guided tester}.



\input{testingMethodology}
\input{testingObjectives}
